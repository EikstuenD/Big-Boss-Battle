<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Boss Battle</title>
    <style>
        /* --- GENERELT --- */
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #050505; color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; align-items: center; }

        /* --- MENY --- */
        #menu-screen { background: #1a1a1a; overflow-y: auto; padding: 20px; z-index: 100; width: 100%; height: 100%; position: absolute; display: flex; flex-direction: column; align-items: center; }
        .config-card { background: #2a2a2a; padding: 30px; border-radius: 15px; border: 1px solid #444; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-top: 20px; }
        .hidden { display: none !important; }

        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; color: #ccc; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; background: #111; border: 1px solid #555; color: white; border-radius: 5px; box-sizing: border-box; }
        
        /* FIL-OPPLASTING STIL */
        .file-box { border: 2px dashed #444; padding: 15px; background: #151515; border-radius: 8px; text-align: center; margin-bottom: 10px; }
        .file-label { color: #3498db; cursor: pointer; font-weight: bold; display: block; }
        .file-status { display: block; margin-top: 5px; font-size: 0.8rem; color: #888; font-style: italic; }
        input[type="file"] { display: none; }

        /* KNAPPER */
        .btn-row { display: flex; gap: 10px; margin-top: 10px; }
        input[type="color"] { width: 50px; padding: 0; border: none; height: 42px; cursor: pointer; }
        
        .start-btn { background: linear-gradient(45deg, #e67e22, #d35400); color: white; font-size: 1.5rem; font-weight: bold; border: none; padding: 15px; width: 100%; margin-top: 30px; cursor: pointer; border-radius: 8px; }
        #back-btn { position: absolute; top: 15px; left: 15px; z-index: 200; background: #444; color: #fff; border: 1px solid #777; padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold; }

        /* --- SPILL --- */
        #game-screen { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 20px; }
        #boss-name { font-size: 3rem; margin: 0; text-shadow: 0 0 10px #000; color: #ff5555; }

        /* HP BAR */
        .hp-frame { width: 60%; height: 40px; background: #333; border: 4px solid #000; border-radius: 20px; position: relative; margin: 10px 0 20px 0; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .hp-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #c0392b, #e74c3c); transition: width 0.3s ease-out; }
        .hp-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: 900; z-index: 2; text-shadow: 1px 1px 2px black; }

        /* --- VIDEO SCENE --- */
        .stage { 
            position: relative; width: 100%; max-width: 800px; flex-grow: 1; 
            display: flex; justify-content: center; align-items: center; 
            overflow: hidden; 
        }

        /* VIKTIG: Begge videoene ligger opp√• hverandre */
        video {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            max-width: 100%; max-height: 100%;
            width: auto; height: auto;
        }

        #vid-idle { z-index: 1; opacity: 1; }
        #vid-react { z-index: 2; opacity: 0; pointer-events: none; } /* Skjult som standard */

        /* Klasser for √• vise reaksjon */
        .playing-reaction #vid-idle { opacity: 0; }
        .playing-reaction #vid-react { opacity: 1; }

        /* --- TEKST EFFEKT --- */
        .damage-text { position: absolute; font-size: 4rem; font-weight: 900; color: #f1c40f; text-shadow: 2px 2px 0 #000; pointer-events: none; animation: floatUp 1s forwards; z-index: 20; }
        @keyframes floatUp { to { transform: translateY(-150px); opacity: 0; } }

        /* --- CONTROLS --- */
        #controls { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.9); border-top: 1px solid #444; padding: 20px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; z-index: 10; }
        .atk-btn { padding: 15px 30px; font-size: 1.8rem; font-weight: bold; border: none; border-radius: 10px; color: white; cursor: pointer; box-shadow: 0 5px rgba(0,0,0,0.5); }
        .atk-btn:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>

    <div id="menu-screen">
        <div class="config-card">
            <h2 style="margin-top:0;">üé• Video Boss Setup</h2>
            
            <label>Boss Navn:</label>
            <input type="text" id="inp-name" value="Video Monsteret">

            <label>Video 1: Loop (Vanlig tilstand)</label>
            <div class="file-box">
                <label for="upload-idle" class="file-label">üìÅ Velg Loop-video</label>
                <input id="upload-idle" type="file" accept="video/*" onchange="handleVideoUpload(this, 'status-idle')">
                <span id="status-idle" class="file-status">Ingen video valgt</span>
            </div>

            <label>Video 2: Reaksjon (N√•r den tar skade)</label>
            <div class="file-box">
                <label for="upload-react" class="file-label">üìÅ Velg Skade-video</label>
                <input id="upload-react" type="file" accept="video/*" onchange="handleVideoUpload(this, 'status-react')">
                <span id="status-react" class="file-status">Ingen video valgt</span>
            </div>

            <label>Maks HP:</label>
            <input type="number" id="inp-hp" value="500">

            <label>Antall knapper:</label>
            <input type="number" id="inp-count" value="3" min="1" max="6" onchange="createBtnInputs()">

            <div id="btn-config"></div>

            <button class="start-btn" onclick="startGame()">Start Spillet</button>
        </div>
    </div>

    <div id="game-screen" class="hidden">
        <button id="back-btn" onclick="backToMenu()">‚Üê Meny</button>
        
        <div id="game-screen-content" style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center;">
            <h1 id="boss-name">Boss</h1>
            <div class="hp-frame">
                <div class="hp-text" id="hp-text">100 / 100</div>
                <div class="hp-fill" id="hp-fill"></div>
            </div>

            <div class="stage" id="stage-area">
                <video id="vid-idle" loop muted playsinline></video>
                
                <video id="vid-react" muted playsinline></video>
            </div>
        </div>

        <div id="controls"></div>
    </div>

    <script>
        // State
        let currentHp = 0; let maxHp = 0;
        let idleVideoSrc = null;
        let reactVideoSrc = null;
        const defaultCols = ['#27ae60', '#2980b9', '#8e44ad', '#f39c12', '#d35400', '#c0392b'];

        window.onload = createBtnInputs;

        // --- FIL H√ÖNDTERING ---
        function handleVideoUpload(input, statusId) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const url = URL.createObjectURL(file); // Lager en midlertidig lenke til filen
                document.getElementById(statusId).innerText = "Valgt: " + file.name;
                
                if(statusId === 'status-idle') idleVideoSrc = url;
                if(statusId === 'status-react') reactVideoSrc = url;
            }
        }

        // --- KNAPPE GENERERING ---
        function createBtnInputs() {
            const count = document.getElementById('inp-count').value;
            const container = document.getElementById('btn-config');
            container.innerHTML = '';
            for(let i=0; i<count; i++) {
                const row = document.createElement('div'); row.className = 'btn-row';
                const valIn = document.createElement('input');
                valIn.type = 'number'; valIn.value = (i+1)*50; valIn.id = `val-${i}`; valIn.placeholder = "Skade";
                const colIn = document.createElement('input');
                colIn.type = 'color'; colIn.value = defaultCols[i % defaultCols.length]; colIn.id = `col-${i}`;
                row.appendChild(valIn); row.appendChild(colIn); container.appendChild(row);
            }
        }

        // --- START SPILL ---
        function startGame() {
            if(!idleVideoSrc) { alert("Du m√• velge en Loop-video!"); return; }

            const name = document.getElementById('inp-name').value;
            maxHp = parseInt(document.getElementById('inp-hp').value);
            currentHp = maxHp;

            document.getElementById('boss-name').innerText = name;
            updateHpBar();

            // Sett opp videoene
            const vIdle = document.getElementById('vid-idle');
            const vReact = document.getElementById('vid-react');

            vIdle.src = idleVideoSrc;
            vIdle.play(); // Start loopen

            if(reactVideoSrc) {
                vReact.src = reactVideoSrc;
            }

            // Lag knapper
            const ctrlDiv = document.getElementById('controls'); ctrlDiv.innerHTML = '';
            const count = document.getElementById('inp-count').value;
            for(let i=0; i<count; i++) {
                const val = document.getElementById(`val-${i}`).value;
                const col = document.getElementById(`col-${i}`).value;
                const btn = document.createElement('button'); btn.className = 'atk-btn';
                btn.innerText = `-${val}`; btn.style.backgroundColor = col;
                if(col === '#f39c12' || col === '#2ecc71') btn.style.color = '#000';
                
                btn.onclick = () => takeDamage(parseInt(val));
                ctrlDiv.appendChild(btn);
            }

            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
        }

        function backToMenu() {
            if(confirm("G√• tilbake til menyen?")) {
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('menu-screen').classList.remove('hidden');
            }
        }

        // --- SKADE LOGIKK ---
        function takeDamage(amount) {
            currentHp -= amount; if(currentHp < 0) currentHp = 0;
            updateHpBar();
            createDamageNumber(amount);
            
            // Start video-reaksjon
            playReactionVideo();

            if(currentHp <= 0) {
                document.getElementById('boss-name').innerText += " (D√òD!)";
            }
        }

        function playReactionVideo() {
            // Hvis vi ikke har lastet opp en reaksjonsvideo, gj√∏r ingenting
            if(!reactVideoSrc) return;

            const stage = document.getElementById('stage-area');
            const vReact = document.getElementById('vid-react');
            const vIdle = document.getElementById('vid-idle');

            // 1. Bytt til reaksjonsmodus (CSS skjuler idle og viser react)
            stage.classList.add('playing-reaction');

            // 2. Start videoen fra start
            vReact.currentTime = 0;
            vReact.play();

            // 3. N√•r videoen er ferdig, bytt tilbake
            vReact.onended = function() {
                stage.classList.remove('playing-reaction');
                vIdle.play(); // S√∏rg for at idle videoen fortsetter
            };
        }

        function updateHpBar() {
            const pct = (currentHp / maxHp) * 100;
            document.getElementById('hp-fill').style.width = pct + '%';
            document.getElementById('hp-text').innerText = `${currentHp} / ${maxHp}`;
        }

        function createDamageNumber(amount) {
            const txt = document.createElement('div'); txt.innerText = `-${amount}`;
            txt.className = 'damage-text';
            const rndX = Math.floor(Math.random() * 100) - 50;
            txt.style.left = `calc(50% + ${rndX}px)`; txt.style.top = '30%';
            document.querySelector('.stage').appendChild(txt);
            setTimeout(() => txt.remove(), 1000);
        }
    </script>
</body>
</html>
