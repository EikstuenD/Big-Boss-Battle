<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Video Boss - Stor Skjerm</title>
    <style>
        /* --- GENERELT --- */
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #050505; color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; align-items: center; }

        /* --- MENY --- */
        #menu-screen { background: #1a1a1a; overflow-y: auto; padding: 20px; z-index: 100; width: 100%; height: 100%; position: absolute; display: flex; flex-direction: column; align-items: center; }
        .config-card { background: #2a2a2a; padding: 30px; border-radius: 15px; border: 1px solid #444; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-top: 20px; margin-bottom: 20px; }
        .hidden { display: none !important; }

        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; color: #ccc; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; background: #111; border: 1px solid #555; color: white; border-radius: 5px; box-sizing: border-box; }
        
        /* FIL-OPPLASTING STIL */
        .file-box { border: 2px dashed #444; padding: 10px; background: #151515; border-radius: 8px; text-align: center; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        .file-label { color: #3498db; cursor: pointer; font-weight: bold; flex-grow: 1; text-align: left; padding-left: 10px;}
        .file-status { font-size: 0.8rem; color: #888; font-style: italic; margin-right: 10px;}
        input[type="file"] { display: none; }

        /* KNAPPER I MENY */
        .btn-row { display: flex; gap: 10px; margin-top: 10px; }
        input[type="color"] { width: 50px; padding: 0; border: none; height: 42px; cursor: pointer; }
        
        .start-btn { background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; font-size: 1.5rem; font-weight: bold; border: none; padding: 15px; width: 100%; margin-top: 30px; cursor: pointer; border-radius: 8px; }
        #back-btn { position: absolute; top: 15px; left: 15px; z-index: 200; background: #444; color: #fff; border: 1px solid #777; padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold; }

        /* --- SPILL SCREEN LAYOUT (Viktig endring her) --- */
        #game-screen { 
            width: 100%; height: 100%; 
            display: flex; flex-direction: column; /* Stable ting vertikalt */
            overflow: hidden;
        }

        /* Innholdet over knappene (Tittel, HP, Video) */
        #game-screen-content {
            flex-grow: 1; /* Ta all tilgjengelig plass */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden; /* Hindre at video stikker utenfor */
            padding-top: 20px;
            padding-bottom: 10px;
            position: relative;
        }

        #boss-name { font-size: 3rem; margin: 0; text-shadow: 0 0 10px #000; color: #ff5555; z-index: 10; }

        /* HP BAR */
        .hp-frame { width: 60%; height: 40px; background: #333; border: 4px solid #000; border-radius: 20px; position: relative; margin: 10px 0 20px 0; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 10; flex-shrink: 0; }
        .hp-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #c0392b, #e74c3c); transition: width 0.3s ease-out; }
        .hp-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: 900; z-index: 2; text-shadow: 1px 1px 2px black; }

        /* --- VIDEO SCENE (St√∏rre og bedre tilpasset) --- */
        .stage { 
            position: relative; 
            width: 98%;             /* Bruk nesten hele bredden */
            max-width: 1600px;      /* Mye st√∏rre maksbredde enn f√∏r */
            height: 100%;           /* Pr√∏v √• fylle h√∏yden i beholderen */
            display: flex; justify-content: center; align-items: center; 
            overflow: hidden;
        }

        /* LAGOPSYSTEM FOR VIDEOER */
        video {
            position: absolute; 
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            /* De nye reglene for √• gj√∏re videoen st√∏rst mulig uten √• kutte: */
            width: 100%;
            height: 100%;
            object-fit: contain; /* Dette er n√∏kkelen! */
            transition: opacity 0.2s;
        }

        /* Standard tilstand: Bare idle synes */
        #vid-idle   { z-index: 1; opacity: 1; }
        #vid-react  { z-index: 2; opacity: 0; }
        #vid-crit   { z-index: 3; opacity: 0; }
        #vid-death  { z-index: 4; opacity: 0; }

        /* Klasser som aktiveres av JS */
        .show-react #vid-idle { opacity: 0; }
        .show-react #vid-react { opacity: 1; }
        .show-crit #vid-idle { opacity: 0; }
        .show-crit #vid-crit { opacity: 1; }
        .show-death #vid-idle { opacity: 0; }
        .show-death #vid-death { opacity: 1; }

        /* --- TEKST EFFEKT --- */
        .damage-text { position: absolute; font-size: 4rem; font-weight: 900; color: #f1c40f; text-shadow: 2px 2px 0 #000; pointer-events: none; animation: floatUp 1s forwards; z-index: 20; }
        @keyframes floatUp { to { transform: translateY(-150px); opacity: 0; } }

        /* --- CONTROLS (Ikke lenger fixed position) --- */
        #controls { 
            width: 100%; 
            background: rgba(0,0,0,0.95); 
            border-top: 1px solid #444; 
            padding: 20px; 
            display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; 
            z-index: 10;
            flex-shrink: 0; /* Sikrer at denne baren ikke krymper */
        }
        .atk-btn { padding: 15px 30px; font-size: 1.8rem; font-weight: bold; border: none; border-radius: 10px; color: white; cursor: pointer; box-shadow: 0 5px rgba(0,0,0,0.5); }
        .atk-btn:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>

    <div id="menu-screen">
        <div class="config-card">
            <h2 style="margin-top:0;">üîä Big Boss Game </h2>
            <p style="font-size: 0.9rem; color: #888; margin-top:-10px;">NB: Husk √• sett en knapp til 100+ skade for √• se Video 3.</p>
            
            <label>Boss Navn:</label>
            <input type="text" id="inp-name" value="Serpentinen">

            <label>1. Basevideo (loop) :</label>
            <div class="file-box">
                <label for="upload-idle" class="file-label">üìÅ Velg fil...</label>
                <input id="upload-idle" type="file" accept="video/*" onchange="handleVideoUpload(this, 'status-idle')">
                <span id="status-idle" class="file-status">Ingen valgt</span>
            </div>

            <label>2. Vanlig Skade (Under 100 hp):</label>
            <div class="file-box">
                <label for="upload-react" class="file-label">üìÅ Velg fil...</label>
                <input id="upload-react" type="file" accept="video/*" onchange="handleVideoUpload(this, 'status-react')">
                <span id="status-react" class="file-status">Ingen valgt</span>
            </div>

            <label>3. KRITISK Skade (100 hp eller mer):</label>
            <div class="file-box">
                <label for="upload-crit" class="file-label">üìÅ Velg fil...</label>
                <input id="upload-crit" type="file" accept="video/*" onchange="handleVideoUpload(this, 'status-crit')">
                <span id="status-crit" class="file-status">Ingen valgt</span>
            </div>

            <label>4. D√∏dsanimasjon:</label>
            <div class="file-box">
                <label for="upload-death" class="file-label">üìÅ Velg fil...</label>
                <input id="upload-death" type="file" accept="video/*" onchange="handleVideoUpload(this, 'status-death')">
                <span id="status-death" class="file-status">Ingen valgt</span>
            </div>

            <label>Maks HP:</label>
            <input type="number" id="inp-hp" value="1000">

            <label>Antall knapper:</label>
            <input type="number" id="inp-count" value="3" min="1" max="6" onchange="createBtnInputs()">

            <div id="btn-config"></div>

            <button class="start-btn" onclick="startGame()">Start Spillet (Klikk her aktiverer lyd)</button>
        </div>
    </div>

    <div id="game-screen" class="hidden">
        <button id="back-btn" onclick="backToMenu()">‚Üê Meny</button>
        
        <div id="game-screen-content">
            <h1 id="boss-name">Boss</h1>
            <div class="hp-frame">
                <div class="hp-text" id="hp-text">100 / 100</div>
                <div class="hp-fill" id="hp-fill"></div>
            </div>

            <div class="stage" id="stage-area">
                <video id="vid-idle" loop playsinline></video>
                <video id="vid-react" playsinline></video>
                <video id="vid-crit" playsinline></video>
                <video id="vid-death" playsinline></video>
            </div>
        </div>

        <div id="controls"></div>
    </div>

    <script>
        // Data
        let currentHp = 0; let maxHp = 0; let isDead = false;
        
        // Lagre URL-er til videoene
        let vidSrc = { idle: null, react: null, crit: null, death: null };
        const defaultCols = ['#27ae60', '#2980b9', '#8e44ad', '#f39c12', '#d35400', '#c0392b'];

        window.onload = createBtnInputs;

        // --- FIL H√ÖNDTERING ---
        function handleVideoUpload(input, statusId) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const url = URL.createObjectURL(file);
                document.getElementById(statusId).innerText = file.name;
                
                // Lagre basert p√• ID
                if(statusId === 'status-idle') vidSrc.idle = url;
                if(statusId === 'status-react') vidSrc.react = url;
                if(statusId === 'status-crit') vidSrc.crit = url;
                if(statusId === 'status-death') vidSrc.death = url;
            }
        }

        // --- KNAPPER ---
        function createBtnInputs() {
            const count = document.getElementById('inp-count').value;
            const container = document.getElementById('btn-config');
            container.innerHTML = '';
            for(let i=0; i<count; i++) {
                const row = document.createElement('div'); row.className = 'btn-row';
                const valIn = document.createElement('input');
                valIn.type = 'number'; valIn.value = (i+1)*50; valIn.id = `val-${i}`; valIn.placeholder = "Skade";
                const colIn = document.createElement('input');
                colIn.type = 'color'; colIn.value = defaultCols[i % defaultCols.length]; colIn.id = `col-${i}`;
                row.appendChild(valIn); row.appendChild(colIn); container.appendChild(row);
            }
        }

        // --- START ---
        function startGame() {
            if(!vidSrc.idle) { alert("Du M√Ö velge en Loop-video (Video 1)!"); return; }

            const name = document.getElementById('inp-name').value;
            maxHp = parseInt(document.getElementById('inp-hp').value);
            currentHp = maxHp; isDead = false;

            document.getElementById('boss-name').innerText = name;
            updateHpBar();

            // Sett kilder
            setVidSource('vid-idle', vidSrc.idle);
            setVidSource('vid-react', vidSrc.react);
            setVidSource('vid-crit', vidSrc.crit);
            setVidSource('vid-death', vidSrc.death);

            // Nullstill visning
            const stage = document.getElementById('stage-area');
            stage.className = 'stage'; 
            
            // Start idle loop (pr√∏v √• spille med lyd)
            const vIdle = document.getElementById('vid-idle');
            vIdle.volume = 1.0; 
            vIdle.play().catch(e => console.log("Lyd kan v√¶re blokkert til du klikker mer: ", e));

            // Lag knapper
            const ctrlDiv = document.getElementById('controls'); ctrlDiv.innerHTML = '';
            const count = document.getElementById('inp-count').value;
            for(let i=0; i<count; i++) {
                const val = document.getElementById(`val-${i}`).value;
                const col = document.getElementById(`col-${i}`).value;
                const btn = document.createElement('button'); btn.className = 'atk-btn';
                btn.innerText = `-${val}`; btn.style.backgroundColor = col;
                if(col === '#f39c12' || col === '#2ecc71') btn.style.color = '#000';
                
                btn.onclick = () => takeDamage(parseInt(val));
                ctrlDiv.appendChild(btn);
            }

            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
        }

        function setVidSource(id, src) {
            const v = document.getElementById(id);
            if(src) {
                v.src = src;
                v.load(); // Sikre at den laster p√• nytt
            } else {
                v.removeAttribute('src'); 
            }
        }

        function backToMenu() {
            if(confirm("G√• tilbake?")) {
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('menu-screen').classList.remove('hidden');
                
                // Stopp alle videoer og lyd n√•r vi g√•r tilbake
                const allVids = document.querySelectorAll('video');
                allVids.forEach(v => v.pause());
            }
        }

        // --- LOGIKK FOR SKADE OG VIDEOVALG ---
        function takeDamage(amount) {
            if(isDead) return;

            currentHp -= amount; if(currentHp < 0) currentHp = 0;
            updateHpBar();
            createDamageNumber(amount);

            // 1. SJEKK OM D√òD
            if(currentHp <= 0) {
                isDead = true;
                playDeathSequence();
                return;
            }

            // 2. SJEKK TYPE SKADE
            if(amount >= 100 && vidSrc.crit) {
                playOneShot('vid-crit', 'show-crit');
            } 
            else if(vidSrc.react) {
                playOneShot('vid-react', 'show-react');
            }
            else if(amount >= 100 && !vidSrc.crit && vidSrc.react) {
                playOneShot('vid-react', 'show-react');
            }
        }

        function playOneShot(vidId, cssClass) {
            const stage = document.getElementById('stage-area');
            const video = document.getElementById(vidId);
            const idle = document.getElementById('vid-idle');

            stage.className = 'stage ' + cssClass;
            idle.pause();

            video.currentTime = 0;
            video.volume = 1.0;
            video.play();

            video.onended = function() {
                if(!isDead) {
                    stage.className = 'stage'; 
                    idle.play();
                }
            };
        }

        function playDeathSequence() {
            document.getElementById('boss-name').innerText += " (D√òD!)";
            if(!vidSrc.death) return;

            const stage = document.getElementById('stage-area');
            const deathVid = document.getElementById('vid-death');
            const idle = document.getElementById('vid-idle');

            idle.pause();
            stage.className = 'stage show-death';
            deathVid.currentTime = 0;
            deathVid.volume = 1.0;
            deathVid.play();
        }

        function updateHpBar() {
            const pct = (currentHp / maxHp) * 100;
            document.getElementById('hp-fill').style.width = pct + '%';
            document.getElementById('hp-text').innerText = `${currentHp} / ${maxHp}`;
        }

        function createDamageNumber(amount) {
            const txt = document.createElement('div'); txt.innerText = `-${amount}`;
            txt.className = 'damage-text';
            const rndX = Math.floor(Math.random() * 100) - 50;
            txt.style.left = `calc(50% + ${rndX}px)`; txt.style.top = '30%';
            document.querySelector('.stage').appendChild(txt);
            setTimeout(() => txt.remove(), 1000);
        }
    </script>
</body>
</html>
