<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Boss Battle - Direkte Opplasting</title>
    <style>
        /* --- GRUNNLEGGENDE STIL --- */
        body {
            margin: 0; font-family: 'Segoe UI', sans-serif;
            background-color: #111; color: #fff; height: 100vh;
            overflow: hidden; display: flex; flex-direction: column; align-items: center;
        }

        /* --- SKJERMER --- */
        .screen { width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* --- MENY STIL --- */
        #menu-screen { background: #1a1a1a; overflow-y: auto; padding: 20px; z-index: 100; width: 100%; box-sizing: border-box;}
        .config-card {
            background: #2a2a2a; padding: 30px; border-radius: 15px;
            border: 1px solid #444; width: 90%; max-width: 600px; margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; color: #ccc; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; background: #111; border: 1px solid #555; color: white; border-radius: 5px; box-sizing: border-box; }
        
        /* FIL-OPPLASTING STIL */
        .file-upload-container {
            border: 2px dashed #555; padding: 20px; text-align: center;
            border-radius: 10px; background: #151515; margin-top: 5px;
        }
        input[type="file"] { display: none; } /* Skjul den stygge standard-knappen */
        .custom-file-upload {
            display: inline-block; padding: 10px 20px; cursor: pointer;
            background: #3498db; color: white; border-radius: 5px; font-weight: bold;
        }
        #file-name-display { display: block; margin-top: 10px; color: #aaa; font-style: italic; }
        #preview-thumb { max-height: 100px; margin-top: 10px; display: none; border-radius: 5px; }

        /* KNAPPE-OPPSETT I MENY */
        .btn-row { display: flex; gap: 10px; margin-top: 10px; }
        input[type="color"] { width: 50px; padding: 0; border: none; height: 42px; cursor: pointer; }
        
        .start-btn {
            background: linear-gradient(45deg, #e67e22, #d35400);
            color: white; font-size: 1.5rem; font-weight: bold; border: none;
            padding: 15px; width: 100%; margin-top: 30px; cursor: pointer; border-radius: 8px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .start-btn:hover { filter: brightness(1.2); }

        /* --- SPILL OMR√ÖDE --- */
        #game-area { 
            position: relative; width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
            padding-top: 20px; 
        }
        #boss-name { font-size: 3rem; margin: 0; text-shadow: 0 0 10px #000; color: #ff5555; }

        /* HELSEBAR */
        .hp-frame {
            width: 60%; height: 40px; background: #333;
            border: 4px solid #000; border-radius: 20px;
            position: relative; margin: 10px 0 30px 0; overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .hp-fill {
            height: 100%; width: 100%;
            background: linear-gradient(90deg, #c0392b, #e74c3c);
            transition: width 0.3s ease-out;
        }
        .hp-text {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 1.2rem; text-shadow: 1px 1px 2px black; z-index: 2;
        }

        /* --- MONSTER SCENE --- */
        .stage {
            position: relative;
            width: 500px; height: 500px;
            display: flex; justify-content: center; align-items: center;
        }

        #monster-img {
            max-width: 90%; max-height: 90%;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
            animation: idleFloat 3s ease-in-out infinite; 
            transition: filter 0.1s;
        }

        /* --- EFFEKTER --- */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both !important; }
        .flash-red { filter: sepia(100%) hue-rotate(-50deg) saturate(600%) contrast(1.2) !important; }

        /* ILD */
        #fire-stream {
            position: absolute;
            top: 50%; left: 50%;
            width: 0px; height: 80px;
            background: linear-gradient(to right, #ffcc00, #ff4500, #8b0000, transparent);
            border-radius: 40% 100% 100% 40%;
            opacity: 0; z-index: 10; pointer-events: none;
            transition: all 0.3s ease; transform-origin: left center;
            filter: blur(4px) brightness(1.5);
            transform: translate(0, -20px) scale(0.5);
        }
        .active-fire {
            width: 300px !important; opacity: 0.9 !important;
            transform: translate(20px, 0) scale(1.5) !important;
        }

        /* Skadetall */
        .damage-text {
            position: absolute; font-size: 4rem; font-weight: 900; color: #f1c40f;
            text-shadow: 2px 2px 0 #000; pointer-events: none;
            animation: floatUp 1s forwards; z-index: 20;
        }
        .dead {
            filter: grayscale(100%) brightness(0.3) blur(2px) !important;
            animation: none !important;
            transform: translateY(50px) rotate(10deg);
            transition: 1s;
        }

        /* ANIMASJONER */
        @keyframes idleFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); }
        }
        @keyframes floatUp { to { transform: translateY(-150px); opacity: 0; } }

        /* --- KNAPPER --- */
        #controls {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(0,0,0,0.8); border-top: 2px solid #444;
            padding: 20px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;
        }
        .atk-btn {
            padding: 15px 30px; font-size: 1.8rem; font-weight: bold;
            border: none; border-radius: 10px; color: white; cursor: pointer;
            box-shadow: 0 5px rgba(0,0,0,0.5); position: relative; top: 0;
        }
        .atk-btn:active { top: 5px; box-shadow: none; }
        
        #back-btn { 
            position: absolute; top: 15px; left: 15px; z-index: 200;
            background: #444; color: #fff; border: 1px solid #777; 
            padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold;
        }
        #back-btn:hover { background: #666; }

    </style>
</head>
<body>

    <div id="menu-screen" class="screen active">
        <div class="config-card">
            <h2 style="margin-top:0;">üî• Boss Battle Oppsett</h2>
            
            <label>Navn p√• Monster:</label>
            <input type="text" id="inp-name" value="Monsteret">

            <label>Last opp Monsterbilde:</label>
            <div class="file-upload-container">
                <label for="file-upload" class="custom-file-upload">
                    üìÅ Klikk her for √• velge bilde
                </label>
                <input id="file-upload" type="file" accept="image/*" onchange="handleImageUpload(this)"/>
                <span id="file-name-display">Ingen fil valgt (bruker standard drage)</span>
                <img id="preview-thumb" src="" alt="Forh√•ndsvisning">
            </div>

            <label>Maks HP:</label>
            <input type="number" id="inp-hp" value="500">

            <label>Antall knapper:</label>
            <input type="number" id="inp-count" value="3" min="1" max="6" onchange="createBtnInputs()">

            <div id="btn-config" style="margin-top: 15px;"></div>

            <button class="start-btn" onclick="startGame()">Start Kampen</button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <button id="back-btn" onclick="backToMenu()">‚Üê Tilbake til Meny</button>
        
        <div id="game-area">
            <h1 id="boss-name">Boss</h1>
            <div class="hp-frame">
                <div class="hp-text" id="hp-text">100 / 100</div>
                <div class="hp-fill" id="hp-fill"></div>
            </div>
            <div class="stage">
                <img id="monster-img" src="" alt="Monster">
                <div id="fire-stream"></div>
            </div>
        </div>
        <div id="controls"></div>
    </div>

    <script>
        let currentHp = 0; let maxHp = 0; let isDead = false;
        
        // Standard bilde (hvis man ikke laster opp noe)
        let loadedImageSrc = "https://cdn-icons-png.flaticon.com/512/3069/3069172.png";
        
        const defaultCols = ['#27ae60', '#2980b9', '#8e44ad', '#f39c12', '#d35400', '#c0392b'];

        window.onload = createBtnInputs;

        // --- H√ÖNDTER BILDEOPPLASTING ---
        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Lagre bildet i en variabel
                    loadedImageSrc = e.target.result;
                    
                    // Vis forh√•ndsvisning
                    document.getElementById('file-name-display').innerText = input.files[0].name;
                    const thumb = document.getElementById('preview-thumb');
                    thumb.src = e.target.result;
                    thumb.style.display = "inline-block";
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function createBtnInputs() {
            const count = document.getElementById('inp-count').value;
            const container = document.getElementById('btn-config');
            container.innerHTML = '';
            for(let i=0; i<count; i++) {
                const row = document.createElement('div'); row.className = 'btn-row';
                const valIn = document.createElement('input');
                valIn.type = 'number'; valIn.value = (i+1)*50; valIn.id = `val-${i}`; valIn.placeholder = "Skade";
                const colIn = document.createElement('input');
                colIn.type = 'color'; colIn.value = defaultCols[i % defaultCols.length]; colIn.id = `col-${i}`;
                row.appendChild(valIn); row.appendChild(colIn); container.appendChild(row);
            }
        }

        function startGame() {
            // Hent verdier
            const name = document.getElementById('inp-name').value;
            maxHp = parseInt(document.getElementById('inp-hp').value);
            currentHp = maxHp; isDead = false;

            // Sett opp spillskjerm
            document.getElementById('boss-name').innerText = name;
            
            // BRUK DET OPPLASTEDE BILDET
            document.getElementById('monster-img').src = loadedImageSrc;
            document.getElementById('monster-img').classList.remove('dead');
            
            updateHpBar();

            // Lag knapper
            const ctrlDiv = document.getElementById('controls'); ctrlDiv.innerHTML = '';
            const count = document.getElementById('inp-count').value;
            for(let i=0; i<count; i++) {
                const val = document.getElementById(`val-${i}`).value;
                const col = document.getElementById(`col-${i}`).value;
                const btn = document.createElement('button'); btn.className = 'atk-btn';
                btn.innerText = `-${val}`; btn.style.backgroundColor = col;
                if(col === '#f39c12' || col === '#2ecc71') btn.style.color = '#000';
                btn.onclick = () => takeDamage(parseInt(val));
                ctrlDiv.appendChild(btn);
            }
            
            // Bytt skjerm uten √• laste p√• nytt
            document.getElementById('menu-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
        }

        // --- FUNKSJON FOR √Ö G√Ö TILBAKE UTEN √Ö SLETTE ALT ---
        function backToMenu() {
            if(confirm("G√• tilbake til menyen? (Kampen nullstilles, men bildet huskes)")) {
                document.getElementById('game-screen').classList.remove('active');
                document.getElementById('menu-screen').classList.add('active');
            }
        }

        function takeDamage(amount) {
            if(isDead) return;
            currentHp -= amount; if(currentHp < 0) currentHp = 0;
            updateHpBar();
            createDamageNumber(amount);
            triggerHitEffect();
            // SPYT ILD HVIS SKADE >= 100
            if(amount >= 100) { triggerFireBreath(); }
            if(currentHp <= 0) { isDead = true; defeatMonster(); }
        }

        function updateHpBar() {
            const pct = (currentHp / maxHp) * 100;
            document.getElementById('hp-fill').style.width = pct + '%';
            document.getElementById('hp-text').innerText = `${currentHp} / ${maxHp}`;
        }

        function triggerHitEffect() {
            const img = document.getElementById('monster-img');
            img.classList.remove('shake', 'flash-red'); void img.offsetWidth;
            img.classList.add('shake'); img.classList.add('flash-red');
            setTimeout(() => { img.classList.remove('shake', 'flash-red'); }, 500);
        }

        function triggerFireBreath() {
            const fire = document.getElementById('fire-stream');
            fire.classList.add('active-fire');
            setTimeout(() => { fire.classList.remove('active-fire'); }, 1000);
        }

        function createDamageNumber(amount) {
            const txt = document.createElement('div'); txt.innerText = `-${amount}`;
            txt.className = 'damage-text';
            const rndX = Math.floor(Math.random() * 100) - 50;
            txt.style.left = `calc(50% + ${rndX}px)`; txt.style.top = '20%';
            document.querySelector('.stage').appendChild(txt);
            setTimeout(() => txt.remove(), 1000);
        }

        function defeatMonster() {
            document.getElementById('monster-img').classList.add('dead');
            document.getElementById('boss-name').innerText += " (BESEIRET!)";
            document.getElementById('boss-name').style.color = "#555";
        }
    </script>
</body>
</html>
